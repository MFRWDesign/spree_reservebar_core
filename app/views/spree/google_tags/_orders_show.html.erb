<% if controller.controller_name == "orders" && controller.action_name == "show" %>
  <% if flash[:commerce_tracking] %>
    <% if @order.line_items.map {|li| li.product.brand.brand_owner.title}.include?("Diageo") %>
      <script type="text/javascript">
        var dataLayer = [{
          "navigation" : {
            "pageName" : "Confirmation"
          },
          "order" : {
            "id" : "<%= @order.number %>",
            "sender": {"city": "<%= @order.bill_address.city -%>", "state": "<%= @order.bill_address.state.abbr -%>" }
          },
          "items" : [
            <%=raw (@order.line_items.map { |line_item| '{"productID": "' + line_item.variant.sku + '", "productName": "' + line_item.variant.name + '", "quantity": ' + line_item.quantity.to_s + ', "productBrand" : "' + line_item.product.brand.title + '" }' if line_item.product.brand.brand_owner.title == "Diageo" }).join(",") %>
          ]
        }];
      </script>
      <%= render partial: 'spree/google_tags/gtm_code' %>
    <% end %>
  <% end %>
<% end %>
